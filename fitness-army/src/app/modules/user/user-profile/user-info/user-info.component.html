<div class="container text-white pt-5">
  <nz-spin [nzSpinning]="true" *ngIf="fetchingData"></nz-spin>
  <ng-container *ngIf="!fetchingData">
    <div class="row pt-3">
      <h2 class="head text-white text-center">Profile</h2>
    </div>
    <div class="row pt-5 pb-5 d-flex align-items-center justify-content-around">
      <!-- User image and personal info section -->
      <div class="col-xs-12 col-lg-4 d-flex flex-column align-items-center">
        <div class="profile-image-wrapper">
          <img [src]="user?.profileImage"/>
        </div>
        <span class="user-name fw-bolder pt-2">{{user?.displayName}}</span>
        <span class="user-email">{{user?.email}}</span>
      </div>
      <!-- Update user info section -->
      <ng-container *ngIf="!userBodyStats || editMode else bodyStats">
        <div class="col-xs-12 col-lg-8">
          <form nz-form [formGroup]="userBodyStatsForm" class="user-stats-form">
            <nz-form-item>
              <nz-form-label nzFor="birthDate">
                <span class="text-white">Date of birth</span>
                </nz-form-label>
              <nz-form-control nzHasFeedback nzErrorTip="Please select a date!">
                <nz-date-picker [style]="{display: 'block', width: '100%'}" nzFormat="yyyy-MM-dd HH:mm:ss"
                                id="birthDate"
                                formControlName="dateOfBirth"></nz-date-picker>
              </nz-form-control>
            </nz-form-item>
            <nz-form-item>
              <nz-form-label nzFor="weight">
                <span class="text-white">Weight</span>
              </nz-form-label>
              <nz-form-control nzHasFeedback nzErrorTip="Please enter valid weight!">
                <input nz-input id="weight" type="number" step="0.1" formControlName="weight"/>
              </nz-form-control>
            </nz-form-item>
            <nz-form-item>
              <nz-form-label nzFor="height">
                <span class="text-white">Height</span>
              </nz-form-label>
              <nz-form-control nzHasFeedback nzErrorTip="Please enter valid height!">
                <input nz-input id="height" type="number" step="0.1" formControlName="height"/>
              </nz-form-control>
            </nz-form-item>
            <nz-form-item>
              <nz-form-label>
                <span class="text-white">Gender</span>
              </nz-form-label>
              <nz-form-control nzHasFeedback nzErrorTip="Please select gender!">
                <nz-radio-group formControlName="gender">
                  <label nz-radio nzValue="male">Male</label>
                  <label nz-radio nzValue="female">Female</label>
                </nz-radio-group>
              </nz-form-control>
            </nz-form-item>
            <div class="action-button">
              <button nz-button nzType="primary" (click)="editMode ? onUserProfileUpdate()
               : onUserProfileCreate()">{{editMode ? 'Update' : 'Create'}}</button>
              <button *ngIf="editMode" nz-button nzType="default" (click)="editMode = !editMode">Back</button>
            </div>
          </form>
        </div>
      </ng-container>
    </div>
  </ng-container>
</div>

<ng-template #bodyStats>
  <div class="col-xs-12 col-lg-4 d-flex flex-column align-items-center">
    <div class="chart-wrapper">
      <canvas
        baseChart
        chartType="pie"
        [width]="300"
        [height]="300"
        [title]="'Body mass(%)'"
        [options]="chartOptions"
        [data]="chartData"
        [labels]="chartLabels"
        [legend]="true">
      </canvas>
      <p class="user-bfp text-center fw-bold">Body fat
        percentage: {{userBodyStats?.bodyFatPercentage?.bodyFatPercentage + ' %'}}</p>
    </div>
  </div>
  <div class="col-xs-12 col-lg-4 d-flex flex-column align-items-center justify-content-lg-around">
    <div class="user-stats-data-item">
      <span class="user-stats-data-item-label">Height: </span>
      <span class="user-stats-data-item-value">{{userBodyStats?.bodyStats?.height}} cm</span>
    </div>
    <div class="user-stats-data-item">
      <span class="user-stats-data-item-label">Age: </span>
      <span class="user-stats-data-item-value">{{userBodyStats?.bodyStats?.age}}</span>
    </div>
    <div class="user-stats-data-item">
      <span class="user-stats-data-item-label">Current Weight:</span>
      <span class="user-stats-data-item-value">{{userBodyStats?.bodyStats?.weight + ' kg'}}</span>
    </div>
    <div class="user-stats-data-item">
      <span class="user-stats-data-item-labelL">BMI: </span>
      <span class="user-stats-data-item-value">{{userBodyStats?.bodyMassIndex?.bmi + '%'}}</span>
    </div>
    <div class="user-stats-data-item">
      <span class="user-stats-data-item-label">Health stats: </span>
      <span class="user-stats-data-item-value">{{userBodyStats?.bodyMassIndex?.health}}</span>
    </div>
    <div class="user-stats-data-item">
      <span class="user-stats-data-item-label">Healthy BMI range:</span>
      <span class="user-stats-data-item-value">{{userBodyStats?.bodyMassIndex?.healthyBmiRange}}</span>
    </div>
  </div>
  <div class="user-stats-wrapper">
    <div class="update-button-wrapper">
      <button class="update-button" nz-button nzType="primary" (click)="enterEditMode()">Update body stats</button>
    </div>
  </div>
</ng-template>
